% FuseBox Report
%
% Fall 2015
%
% By: Taylor Andrews

\documentclass[11pt,twocolumn,letterpaper]{article}

% System Packages
\usepackage{epsfig}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tabu}
\usepackage{color}
\usepackage{hyperref}
\usepackage{url}

% Local Packages
% None

% Package Options
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

% Macros
\input{macros.tex}

% Other Options
\clubpenalty = 10000
\widowpenalty = 10000

% Variables
\newcommand{\appname}{FuseBox }
\newcommand{\appnameWOspace}{FuseBox}

\newcommand{\custos}{Tutamen }
\newcommand{\custosWOspace}{Tutamen}

% Start
\begin{document}

\title{\appname}

\author{Taylor Andrews}

\maketitle

\begin{abstract}
Security in the digital age is an ever evolving problem.
Services are doing their very best to protect sensitive data. 
However, in the face of social engineering attacks and other more technical
exploits, it can be on the user to go the extra step to make sure
their data is safe. Safety, however, should not come at the cost of
sharing data between trusted people and devices. Take Dropbox for
example~\cite{dropbox}. It supports many sharing features, so users can't just
encrypt and decrypt their files on a single computer. A more robust,
and shareable, way to encrypt files is needed. 
\appname aims to be a solution to this problem by providing a
transparent layer of security between the end user and Dropbox. Files
that pass through \appname are encrypted when uploaded to Dropbox. 
Encryption, decryption, and authentication are all supported by \appnameWOspace.
%Shareability is provided using Custos, a ``Secret Storage as a Service''
%(SSaaS) platform CITATION?. Custos allows for key sharing amongst
%people and computers. 
This paper will lay out
the design and implementation of \appnameWOspace, as well as 
future goals for the project.    
\end{abstract}

\section{Introduction}
\label{sec:intro}
Unsecured data is a gamble, a risk. No one wants to think that
they could be the target of an attack. The idea of keeping things safe
is nothing complicated. However, to the layman, the intricacies of
actually protecting data are somewhat out of reach. This problem
becomes compounded when a single person wants to safely share data
with trusted partners. Cloud-based products, like Dropbox, are built
on the ability to share and transfer data. How can users protect their
data while still being able to normally use Dropbox? 
\par Fortunately, part of the solution to this problem already exits.
\custosWOspace, a ``Secret Storage as a Service'' (SSaaS), 
provides a flexible means of storing and
retrieving secrets~\cite{custostrios}. The SSaaS model supports the features of
Dropbox that \appname needs to interact with. Leveraging \custos allows \appname to 
authenticate in conjunction with cloud based services. The user's
identity can be confirmed, and the appropriate key retrieved, on any number
of platforms. In addition, \custos provides the user with the 
flexibility to choose how they want to authenticate themselves. 
\par Getting a key in this manner relieves the problems associated
with using the cloud. The user's data, however, still needs to be
protected. \appname aims to accomplish this as transparently as
possible. To the end user, it appears that they are just normally
interacting with their Dropbox. They can read, write, and create
files. These files, from the perspective of Dropbox, are actually
encrypted. If Dropbox is somehow compromised, data that passes through \appname
will not be.    

\subsection{Goals}
\label{sec:goals}
\appname was created with two primary goals: transparency and consistency. 
\par {\bf Transparency:} Dropbox is a very convenient application to
use. Put files in, get files out. The existing desktop application
allows for seamlessly uploading and downloading files~\cite{dropboxclient}. The end user
gets to take advantage of all the nice features of Dropbox at little
to no effort on their end. \appname is built to keep this same 
seamless feel while preserving the features of Dropbox. Meanwhile behind the
scenes encryption, decryption, and authentication work together to
secure the data.     
\par {\bf Consistency:} \appnameWOspace's performance is bound by
the speed of internet because it must connect to Dropbox. 
\appname does not seek to overcome this
limitation. Rather, regardless of file type or file size, the client
is designed to perform equally well. Larger files should not create
massive latency when using \appnameWOspace. This means the user is not
limited when using the client.    

\section{Design}
\label{sec:design}
\appname is, in essence, an encrypted file system built on
Dropbox. Its components are as follows:
\par {\bf File System:} The file system is the main component of 
\appnameWOspace. It mounts on the users home computer and handles 
all interactions with Dropbox. The file system controls when
encryption/decryption and key storage/retrieval occur.   
\par {\bf Encryption:} Handles securely encrypting and decrypting file data
given a secret key. 
\par {\bf Key Storage:} Handles key storage, key retrieval, and user
authentication so that the user may access their key. 

\subsection{File System}
\label{sec:fs}
\appname is a transparent and consistent file system. The major design
decisions for the file system include: how to mount the file system on
the user's computer and when the interactions with Dropbox should
occur. 
\par Mounting the file system is a necessary step to connect the user
with \appnameWOspace. I chose to give user control over when the file
system is mounted and when it is not.  
\par The file system connects to Dropbox via an oauth token. The user must
generate this token with their account information. In order to make
\appname more usable in the long-term, this oauth token need only be
constructed by the user one time. Then, the file system, once mounted,
just continues to use the specified oauth token until it expires or is
revoked by the user. 
\par Interaction with Dropbox is restricted to three simple
operations: downloading a file, uploading a file, and reading Dropbox
file metadata. The file system must use these operations in
conjunction with normal file operations such as read and write. Some
aspects of this were simple. The Dropbox metadata is obtained when the
file system reads the attributes of the file. Others were less so.
\par The relevant file system operations are read, write, open, and
release. The decision boils down to whether files are downloaded in
open or read, and whether they are uploaded in write or create. The
current implementation is simpler. It downloads the whole files in open and uploads in
release. In the future, I would like to move the design to download in
read and upload in write. This allows for an approach more geared at
streaming files, since the file system can download on the section of the file that
needs to be read. 

\subsection{Encryption}
\label{sec:enc}
Encryption is what differentiates \appname from just being a basic
Dropbox client. The selection of a cryptographic algorithm, as well as
any additional features of encryption, was a key design choice. What
algorithm adheres best to the core goals of \appnameWOspace? Based on
this criteria, I choose an AES stream cipher over an AES block
cipher. More specifically, AES in CTR mode~\cite{AESCTR}.  
\par A stream cipher is ideal for \appname because it has better
performance for random access. Since the AES block 
cipher relies on a feedback loop, it must always decrypt and encrypt
the whole file at a time. \appname seeks to provide consistent
performance for files large and small. A block cipher would create
too large a latency.   
\par The other primary goal of \appname is transparency. This means
file sizes should not indicate data is being encrypted. In order to
accomplish this I decided to store the unencrypted file size in the
metadata of the file. 

\subsection{Key Storage}
\label{sec:keystorage}
Key storage and retrieval is a critical feature of \appnameWOspace. 
Encryption and decryption could be accomplished on a single users
computer with their private key. This, however, restricts many of the
functionalities of Dropbox. Using \custos keys are shared, and thus 
sharing features can be utilized. The main design choice for \appname
concerns how to integrate key storage.  
\par Metadata is required to interact with \custosWOspace. This
metadata could be stored either within the file itself, or else in a
separate metadata file. Also, it could either be a fixed size or a
variable size. Fixed sized metadata can be quickly discarded. Though
it is simple, since metadata in \appname is not all the same size,
determining a fixed size would be difficult. It also doesn't allow for
easy future expansion of metadata if necessary. 
\par Storing variable sized metadata within the file itself has its
own problems. The complexity of implementation increases. To avoid
this complexity I decided to store metadata in an external file. This
file contains all the information needed to access \custosWOspace. It
is flexible to any future expansions of metadata. 
To preserve transparency the metadata files are hidden. 

\section{Implementation}
\label{sec:implementation}
The implementation of \appname approximately follows the key aspects
of its design. That is, the file system, encryption, and key storage
are the primary components. Source code for \appname is available at~\cite{FuseBox}.

\subsection{File System}
\label{sec:fsimp}
The two main aspects of the file system are FUSE and the Dropbox Core
API. FUSE, or File System in Userspace, allows for implementation of a
full file system inside an userspace program~\cite{fuse}. The Dropbox
API allows for communication between the host computer and Dropbox
files~\cite{dropboxcore}.
\par FUSE is an ideal backbone for an encrypted file system. It allows
for non-privileged users to mount and unmount \appnameWOspace. At the
moment, \appname doesn't make full use of all the functionality FUSE
offers. For example, file permissions. This, however, could be expanded in the future. 
\par The Dropbox Core API v1 was chosen over the Sync API or Datastore
API because it provides the appropriate interactions with a single
user's Dropbox. For \appnameWOspace, the API is used within FUSE
calls. This is how doing normal file operations is able to connect
with Dropbox. 

\subsection{Encryption}
\label{sec:encimp}
As previously discussed, \appnameWOspace's encryption and decryption
is AES in CTR mode. This is accomplished using PyCrypto~\cite{pycrypto}.
PyCrypto was chosen because it provides support for the less
frequently used CTR
mode. It also has important features like implementing a nonce to
randomize the counter. 
\par One downside to this library was that, despite using CTR mode,
encryption blocks had to be padded out to the AES Block Size. This was
accomplished simply by padding with zeroes until the last byte of the
file, which holds the number of padding bytes.  

\subsection{Key Storage}
\label{sec:ksimp}
Key storage and retrieval is provided
by \custosWOspace~\cite{Pytutamen}. \appname interacts with two aspects
of \custosWOspace, collections and secrets. In the current version
of \appnameWOspace, collections and secrets are a one-to-one
relationship with files. Thus, every files stores metadata containing
both a collection uuid and a secret uuid. 
\par One key per file allows for sharing to be as granular as
possible. That way the user can select exactly what they would like to share.
At the moment, the one-to-one relationship is simple. In the future, \appname
could be expanded to have multiple keys per file. This allows for
finer user control as one key could be more strict with it's
authentication measures and another less so.   

\section{Conclusion}
\label{sec:conclusion}
\appname provides value by being more than just an encrypted file
system. It allows for secure sharing between people and work stations.
Users don't have to sacrifice security for sharing, nor sharing for
security. 
\par However, \appname is still incomplete. In the future, optimizations
could be made to increase consistency of performance. These include
file streaming for random access. The libraries and APIs \appname is
built on could afford to be updated. Dropbox, for example, has recently released an
updated version of their API. I look forward to continuing and
improving the \appname project.    

\bibliographystyle{acm}
\bibliography{refs}

\end{document}
